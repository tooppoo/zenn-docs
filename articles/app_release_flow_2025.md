---
title: "2025å¹´å€‹äººé–‹ç™ºã®ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼"
emoji: "ğŸ”§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
published: true
---

## è‡ªå‹•åŒ–ã¨äººçš„åˆ¶å¾¡ã®ãƒãƒ©ãƒ³ã‚¹

ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®CI/CDã¯é­…åŠ›çš„ã ãŒã€æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯æœ€å¾Œã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆãŒæ¬²ã—ã„ã€‚ã‹ã¨ã„ã£ã¦æ‰‹å‹•ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã ã‚‰ã‘ã§ã¯ãƒŸã‚¹ã®ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã‚‹ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€Changesetsã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®è‡ªå‹•åŒ–ã¨ã€ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ã‚’çµ„ã¿åˆã‚ã›ãŸãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼ã‚’ã€å€‹äººç”¨ãƒ¡ãƒ¢ãŒã¦ã‚‰ç´¹ä»‹ã™ã‚‹ã€‚ã“ã®ãƒ•ãƒ­ãƒ¼ã¯ã€å®Ÿéš›ã«é‹ç”¨ä¸­ã®ã€Œ[AC6 Assemble Tool](https://github.com/tooppoo/ac6_assemble_tool)ã€ã§æ¡ç”¨ã—ã¦ã„ã‚‹æ§‹æˆã§ã‚ã‚‹ã€‚

## æ§‹æˆè¦ç´ 

### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥ï¼šmainä¸€æœ¬

è¤‡é›‘ãªãƒ–ãƒ©ãƒ³ãƒç®¡ç†ã‚’é¿ã‘ã€mainãƒ–ãƒ©ãƒ³ãƒã®ã¿ã§é‹ç”¨ã€‚trunk-based developmentã®è€ƒãˆæ–¹ã«è¿‘ã„ã€‚

- ãƒ–ãƒ©ãƒ³ãƒç®¡ç†ã‚³ã‚¹ãƒˆã®å‰Šæ¸›
- ãƒãƒ¼ã‚¸ç«¶åˆã®æœ€å°åŒ–
- ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½çŠ¶æ…‹ã®æ˜ç¢ºåŒ–ï¼ˆmain = ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ï¼‰

### Changesetsã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«ã¯[changesets](https://github.com/changesets/changesets)ã‚’ä½¿ç”¨ï¼ˆè©³ç´°ãªä½¿ã„æ–¹ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ï¼‰ã€‚

é–‹ç™ºè€…ãŒä¿®æ­£ã¾ãŸã¯`changesets` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã€å¤‰æ›´å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã§ãã‚‹ã€‚

`changesets` ç”¨ã®[GitHub Action](https://github.com/changesets/action)ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚
ã“ã‚Œã‚’ä½¿ã†ã¨

- å¤‰æ›´å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ -> ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°PRã‚’è‡ªå‹•ä½œæˆ
- å¤‰æ›´å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ -> ä½•ã‚‚ã—ãªã„

ã¨ã„ã†åˆ¤å®šãƒ»å‡¦ç†ã‚’è‡ªå‹•ã§è¡Œã£ã¦ãã‚Œã‚‹ã€‚

## 2ç¨®é¡ã®ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

å¤‰æ›´å†…å®¹ã«ã‚ˆã£ã¦ã€ã€Œã‚µã‚¯ãƒƒã¨ or é€Ÿã‚„ã‹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„ã€ã‚‚ã®ã¨ã€Œã—ã£ã‹ã‚Šç¢ºèªã—ã¦ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã™ã‚‹ã‚‚ã®ã¨ãŒã‚ã‚‹ã€‚ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€renovateã«ã‚ˆã‚‹ä¾å­˜æ›´æ–°ãŒå‰è€…ã€æ™®æ®µã®é–‹ç™ºã«ã‚ˆã‚‹å¤‰æ›´å†…å®¹ãŒå¾Œè€…ã ã£ãŸã€‚

ãã“ã§

- renovateæ›´æ–°ã§ã¯ã€ŒPRã‚’ãƒãƒ¼ã‚¸ã—ãŸã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã‚‚ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã™ãã«ãƒªãƒªãƒ¼ã‚¹ã€
- æ™®æ®µã®é–‹ç™ºã§ã¯ã€Œæ‰‹å‹•ç¢ºèªã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã‚’æŒŸã‚“ã§ç¢ºå®Ÿã«ãƒªãƒªãƒ¼ã‚¹ã€

ã¨ã„ã†ä½¿ã„åˆ†ã‘ã‚’ã—ãŸã€‚

## renovateã«ã‚ˆã‚‹ä¾å­˜æ›´æ–°ã®ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[renovate] --> B[PRä½œæˆ]
    B --> C[ãƒãƒ¼ã‚¸]
    C --> E[è‡ªå‹•ãƒªãƒªãƒ¼ã‚¹<br/>ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ®ãˆç½®ã]
    E --> F[æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤<br/>Cloudflare Pages]
```

å®Ÿéš›ã®Github Actionã¯ [.github/workflows/web-auto-deploy-deps.yml](https://github.com/tooppoo/ac6_assemble_tool/blob/main/.github/workflows/web-auto-deploy-deps.yml)ã‚’å‚ç…§ã€‚

### ãªãœä¾å­˜æ›´æ–°ã ã‘è‡ªå‹•åŒ–ã™ã‚‹ã®ã‹

#### 1. é »åº¦ã®é«˜ã•

ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°ã¯é€±ã«æ•°å›ã€œåæ•°å›ç™ºç”Ÿã™ã‚‹ã€‚æ¯å›æ‰‹å‹•ãƒªãƒªãƒ¼ã‚¹ã®æ‰‹é †ã‚’è¸ã‚€ã®ã¯ç¾å®Ÿçš„ã§ãªã„ã€‚

#### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾å¿œã®è¿…é€Ÿæ€§

è„†å¼±æ€§ä¿®æ­£ã‚’å«ã‚€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ›´æ–°ã¯ã€ã§ãã‚‹ã ã‘æ—©ãæœ¬ç•ªã«åæ˜ ã—ãŸã„ã€‚æ‰‹å‹•æ‰¿èªã‚’å¾…ã¤ã“ã¨ã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒå»¶ã³ã‚‹ã®ã¯é¿ã‘ãŸã„ã€‚

#### 3. ãƒªã‚¹ã‚¯ã®ä½ã•

ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«ç›´æ¥å½±éŸ¿ã—ãªã„ã€‚è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼ˆå˜ä½“ãƒ†ã‚¹ãƒˆã€E2Eãƒ†ã‚¹ãƒˆãªã©ï¼‰ãŒãƒ‘ã‚¹ã—ã¦ã„ã‚Œã°ã€ãƒªãƒªãƒ¼ã‚¹ã—ã¦OKã¨ã„ã†åˆ¤æ–­ã€‚

## é–‹ç™ºã«ã‚ˆã‚‹æ©Ÿèƒ½è¿½åŠ ãƒ»å¤‰æ›´æ™‚ã®ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[é–‹ç™º] --> A2[changesetsã§<br>å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ]
    A2 --> B[PRä½œæˆ]
    B --> C[ãƒãƒ¼ã‚¸]
    C --> G[Changesetsèª­ã¿å–ã‚Š]
    G --> H[ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°PR<br/>è‡ªå‹•ä½œæˆ]
    H --> I[äººé–“ãŒç¢ºèªãƒ»ãƒãƒ¼ã‚¸]
    I --> J[workflow_dispatch<br/>æ‰‹å‹•ãƒªãƒªãƒ¼ã‚¹]
    J --> K[GitHub Release<br/>+ ã‚¿ã‚°ä½œæˆ]
    J --> L[æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤<br/>Cloudflare Pages]
```

å®Ÿéš›ã®Github Actionã¯ä»¥ä¸‹ã‚’å‚ç…§

- [.github/workflows/update-package-version.yml](https://github.com/tooppoo/ac6_assemble_tool/blob/main/.github/workflows/update-package-version.yml)
- [.github/workflows/web-create-release.yml](https://github.com/tooppoo/ac6_assemble_tool/blob/main/.github/workflows/web-create-release.yml)

### ãªãœæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ã‹

- ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼š
  - ãƒªãƒªãƒ¼ã‚¹å¾Œã®ç›£è¦–æ™‚é–“ã‚’ç¢ºä¿ã§ãã‚‹æ™‚é–“å¸¯ã€éšœå®³å¯¾å¿œå¾Œãªã©ã€é©åˆ‡ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã§ãã‚‹
- æœ€çµ‚ç¢ºèªã®æ©Ÿä¼šï¼š
  - previeç’°å¢ƒã§ã®å‹•ä½œç¢ºèªå¾Œãªã©ã€æœ€å¾Œã®å®‰å…¨ç¢ºèªãŒã§ãã‚‹
- è¤‡æ•°PRã®ã¾ã¨ã‚ãƒªãƒªãƒ¼ã‚¹ï¼š
  - è¤‡æ•°ã®å¤‰æ›´ã‚’ã¾ã¨ã‚ã¦ä¸€åº¦ã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹æŸ”è»Ÿæ€§

## ã“ã®æ–¹å¼ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•

### ãƒ¡ãƒªãƒƒãƒˆ

- ç¢ºå®Ÿæ€§ï¼š
  - æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹å‰ã«å¿…ãšäººé–“ã®åˆ¤æ–­ãŒå…¥ã‚‹
- æŸ”è»Ÿæ€§ï¼š
  - ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è‡ªç”±ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹
- é©åº¦ãªè‡ªå‹•åŒ–ï¼š
  - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨CHANGELOGã¯ `changesets`ã§è‡ªå‹•æ›´æ–°ãƒ»ç”Ÿæˆ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼š
  - ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§å¯¾å¿œã‚’ç´ æ—©ãåæ˜ 

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

- æ‰‹é †ã®å¤šã•ï¼š
  - Changesetè¿½åŠ  â†’ PR â†’ ãƒãƒ¼ã‚¸ â†’ ãƒãƒ¼ã‚¸ãƒ§ãƒ³PR â†’ ãƒãƒ¼ã‚¸ â†’ æ‰‹å‹•ãƒªãƒªãƒ¼ã‚¹ã®5æ®µéš
- å³åº§ã®ãƒªãƒªãƒ¼ã‚¹ä¸å¯ï¼š
  - hotfixæ™‚ã‚‚æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼å¾…ã¡
- å¿ƒç†çš„è² è·ï¼š
  - ã€Œä»Šãƒªãƒªãƒ¼ã‚¹ã—ã¦å¤§ä¸ˆå¤«ã‹ã€ã®åˆ¤æ–­ã‚’æ¯å›è¡Œã†å¿…è¦ãŒã‚ã‚‹

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤ºã®å·¥å¤«

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã‚’è¡¨ç¤ºã—ã€ã©ã®å¤‰æ›´ãŒæœ¬ç•ªã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç‰¹å®šå¯èƒ½ã«ã—ã¦ã„ã‚‹ï¼ˆä¾‹ï¼š`v3.2.6-a2bc949`ï¼‰ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ã©ã®å¤‰æ›´ãŒæœ¬ç•ªã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã«ã‚ˆã‚‰ãšå¸¸ã«ç‰¹å®šå¯èƒ½ã«ã—ã¦ã„ã‚‹ã€‚

ä»¥ä¸‹ã¯ [`vite.config.ts`](https://github.com/tooppoo/ac6_assemble_tool/blob/main/packages/web/vite.config.ts) ã‹ã‚‰ã®æŠœç²‹ã€‚

```typescript
const pkg = (() => {
  const raw = fs.readFileSync('package.json', { encoding: 'utf-8' })
  return JSON.parse(raw)
})()

const shortHash = (() => {
  try {
    if (process.env.GITHUB_SHA) return process.env.GITHUB_SHA.slice(0, 7)
    const out = execSync('git rev-parse --short HEAD', {
      encoding: 'utf-8',
      stdio: ['ignore', 'pipe', 'ignore'],
    })
    return out.trim()
  } catch {
    return 'dev'
  }
})()

export default defineConfig({
  define: {
    __APP_VERSION__: JSON.stringify(`${pkg.version}-${shortHash}`),
  },
  // ä¸­ç•¥
}
```

## ã¾ã¨ã‚

ã“ã®ãƒ•ãƒ­ãƒ¼ã¯ã€ã€Œãªã¾ã˜å…¨è‡ªå‹•ã‚ˆã‚Šå®‰å¿ƒã€ã¨ã„ã†æ€æƒ³ã§è¨­è¨ˆã—ã¦ã„ã‚‹ã€‚

- Changesets = ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã®è‡ªå‹•åŒ–
- æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ = ãƒªãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®åˆ¶å¾¡
- ä¾å­˜æ›´æ–°ã®è‡ªå‹•åŒ– = ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ä¸¡ç«‹

æ‰‹é †ã¯å¤šã„ãŒã€å„æ®µéšã§ç¢ºèªãŒå…¥ã‚‹ã€‚å€‹äººé–‹ç™ºã§å®Ÿéš›ã«é‹ç”¨ã—ã¦åŠ¹æœã‚’å®Ÿæ„Ÿã—ã¦ãŠã‚Šã€å°è¦æ¨¡ãƒãƒ¼ãƒ ã§ã‚‚æœ‰åŠ¹ãªæ§‹æˆã ã¨è€ƒãˆã¦ã„ã‚‹ã€‚

å®Œå…¨è‡ªå‹•åŒ–ã§ã¯ãªãã€é©åˆ‡ãªç®‡æ‰€ã«äººé–“ã®åˆ¤æ–­ã‚’æ®‹ã™ã“ã¨ã§ã€è‡ªå‹•åŒ–ã¨åˆ¶å¾¡ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã€‚ãã‚ŒãŒã“ã®ãƒ•ãƒ­ãƒ¼ã®è¨­è¨ˆæ„å›³ã§ã‚ã‚‹ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [AC6 Assemble Tool](https://github.com/tooppoo/ac6_assemble_tool)
- [Changesets](https://github.com/changesets/changesets)
- [Changesets GitHub Action](https://github.com/changesets/action)
```
